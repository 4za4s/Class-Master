//

//All the classes stored as an object
var Classes = {
    MonA: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    TueA: {
        Period1: {
            Class: "",
            From: "8:50",
            Until: "9:36"
        },
        Period2: {
            Class: "",
            From: "9:36",
            Until: "10:22"
        },
        Recess: {
            Class: "Recess",
            From: "10:22",
            Until: "10:51"
        },
        Homeroom: {
            Class: "Pastoral",
            From: "10:51",
            Until: "11:31"
        },
        Period3: {
            Class: "",
            From: "11:31",
            Until: "12:17"
        },
        Period4: {
            Class: "",
            From: "12:17",
            Until: "13:03"
        },
        Lunch: {
            Class: "Lunch",
            From: "13:03",
            Until: "13:48"
        },
        Period5: {
            Class: "",
            From: "13:48",
            Until: "14:34"
        },
        Period6: {
            Class: "",
            From: "14:34",
            Until: "15:20"
        }
    },
    WedA: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    ThuA: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    FriA: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    MonB: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    TueB: {
        Period1: {
            Class: "",
            From: "8:50",
            Until: "9:36"
        },
        Period2: {
            Class: "",
            From: "9:36",
            Until: "10:22"
        },
        Recess: {
            Class: "Recess",
            From: "10:22",
            Until: "10:51"
        },
        Homeroom: {
            Class: "Pastoral",
            From: "10:51",
            Until: "11:31"
        },
        Period3: {
            Class: "",
            From: "11:31",
            Until: "12:17"
        },
        Period4: {
            Class: "",
            From: "12:17",
            Until: "13:03"
        },
        Lunch: {
            Class: "Lunch",
            From: "13:03",
            Until: "13:48"
        },
        Period5: {
            Class: "",
            From: "13:48",
            Until: "14:34"
        },
        Period6: {
            Class: "",
            From: "14:34",
            Until: "15:20"
        }
    },
    WedB: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    ThuB: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    },
    FriB: {
        Homeroom: {
            Class: "Homeroom",
            From: "8:50",
            Until: "9:10"
        },
        Period1: {
            Class: "",
            From: "9:10",
            Until: "10:00"
        },
        Period2: {
            Class: "",
            From: "10:00",
            Until: "10:50"
        },
        Recess: {
            Class: "Recess",
            From: "10:50",
            Until: "11:15"
        },
        Period3: {
            Class: "",
            From: "11:15",
            Until: "12:05"
        },
        Period4: {
            Class: "",
            From: "12:05",
            Until: "12:55"
        },
        Lunch: {
            Class: "Lunch",
            From: "12:55",
            Until: "13:40"
        },
        Period5: {
            Class: "",
            From: "13:40",
            Until: "14:30"
        },
        Period6: {
            Class: "",
            From: "14:30",
            Until: "15:20"
        }
    }
}

firstDay = new Date("08/10/2020")
Days = ["MonA", "TueA", "WedA", "ThuA", "FriA", "Sat", "Sun", "MonB", "TueB", "WedB", "ThuB", "FriB", "Sat", "Sun"]
var wait = false
var audio = new Audio('bell.mp3')

function makeMinutes(time)
{
    var timeParts = time.split(":");

    var timeInMinutes = (timeParts[0] * 60) + timeParts[1];

    return timeInMinutes;
}

function getClass() {
    var time = new Date("08/10/2020 15:20")
    x = (time.getTime() - firstDay.getTime()) / (1000 * 3600 * 24)
    x = Math.floor(x % 14)

    Hour = time.getHours()
    if (Hour < 10){
        Hour = "0" + Hour    
    }

    Minute = time.getMinutes()
    if (Minute < 10){
        Minute = "0" + Minute
    }

    time =  Hour + ":" + Minute
    document.getElementById("Time").innerHTML = time;

    if (Days[x] == "Sun") {  //SUNDAY
        document.getElementById("Current").innerHTML = "It's Sunday";
        document.getElementById("ClassTime").innerHTML = "00:00-23:59";

        for(var i = 1; i < 10; i++){
            document.getElementById(i).innerHTML = ""
        }

    } else if (Days[x] == "Sat") { //SATURDAY
        document.getElementById("Current").innerHTML = "It's Saturday";
        document.getElementById("ClassTime").innerHTML = "00:00-23:59";

        for(var i = 1; i < 10; i++){
            document.getElementById(i).innerHTML = ""
        }
    } else {  //SCHOOL DAYS
        CurrentDay = Classes[Days[x]]

        if (makeMinutes(time) < 48050){ //BEFORE SCHOOL
            document.getElementById("Current").innerHTML = "School Morning";
            document.getElementById("ClassTime").innerHTML = "00:00-08:50";
            
            i = 1
            for(var period in CurrentDay){
                if (CurrentDay[period].Class == ""){
                    document.getElementById(i).innerHTML = "No Class"
                } else {
                    document.getElementById(i).innerHTML = CurrentDay[period].Class
                }
                i += 1
            }

        } else if (makeMinutes(time) >= 90020){ //AFTER SCHOOL
            document.getElementById("Current").innerHTML = "After School";
            document.getElementById("ClassTime").innerHTML = "15:20-23:59";
            if (makeMinutes(time) == makeMinutes("15:20")){
                audio.play()
            }

            for(var i = 1; i < 10; i++){
                document.getElementById(i).innerHTML = ""
            }
        } else { //DURING SCHOOL
            i = 1
            for(var period in CurrentDay){
                if(makeMinutes(time) >= makeMinutes(CurrentDay[period].From) && makeMinutes(time) < makeMinutes(CurrentDay[period].Until)){
                    document.getElementById("Current").innerHTML = CurrentDay[period].Class;
                    document.getElementById("ClassTime").innerHTML = CurrentDay[period].From + "-" + CurrentDay[period].Until;
                } else if (makeMinutes(time) < makeMinutes(CurrentDay[period].Until)){
                    document.getElementById(i).innerHTML = CurrentDay[period].Class
                    i += 1
                }
                if (makeMinutes(time) == makeMinutes(CurrentDay[period].From) || makeMinutes(time) == makeMinutes(CurrentDay[period].From)){
                    audio.play()
                }
            }
            while(i < 10){
                document.getElementById(i).innerHTML = ""
                i += 1
            }
        }
    }
    
}

function updateDisplay() {
    getClass()
    var time = new Date()
    var update = (61 - time.getSeconds()) * 1000
    setTimeout(mytime = () => { 
            setInterval('getClass()', 60000);
            getClass();
        }, 
        update)
}

function Save() {
    for(var days in Classes){
        period = 1
        for(var periods in Classes[days]){
            if(!(periods == "Homeroom" || periods == "Lunch" || periods == "Recess")){
                Classes[days][periods].Class = document.getElementById(days + period).value
                period += 1;
            }
        }
    }

    var Save = JSON.stringify(Classes)
    localStorage.setItem("Save", Save)
}

function Load() {
    if(localStorage.getItem("Save") !== null){
        Classes = JSON.parse(localStorage.getItem("Save"))

        if(!(document.URL.includes("TimeTable"))){
            for(var days in Classes){
                period = 1
                for(var periods in Classes[days]){
                    if(!(periods == "Homeroom" || periods == "Lunch" || periods == "Recess")){
                        document.getElementById(days + period).value = Classes[days][periods].Class
                        period += 1;
                    }
                }
            }
        }
    }
    if(document.URL.includes("TimeTable")){  
        volumeslider = document.getElementById("volumeslider");   
        if(localStorage.getItem("Volume") !== null){
            volumeslider.value = JSON.parse(localStorage.getItem("Volume"))
        }
        audio.volume = volumeslider.value / 100; 
        volumeslider.addEventListener("mousemove", funcVolume = () => {
            audio.volume = volumeslider.value / 100
            var Volume = JSON.stringify(volumeslider.value)
            localStorage.setItem("Volume", Volume)
        } )
    }
}